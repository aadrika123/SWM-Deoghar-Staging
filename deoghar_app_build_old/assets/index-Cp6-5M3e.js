import{h as Ye,i as fe,k as Se,l as f,m as ue,n as Pe,o as qe,p as Ee,q as Ue,r as ke,s as Te,t as be,v as Ie,w as Oe,x as Le,j as e,y as D,d as A,C as Be,B as ne,F as le,_ as ce}from"./index-DDBl9555.js";import{h as v}from"./moment-BjLXg0w5.js";import{u as Fe,o as ze,F as He,S as ie,c as Ve,a as m}from"./SelectField-JgfnMCYN.js";import{R as j}from"./RHFTextField-DObLdURv.js";import{b as je,B as ge}from"./button-C237c5Ap.js";import{r as n,d as We,h as Qe,R as Je}from"./router-CTqkcgir.js";import{P as Ke}from"./index-rhBaYdYa.js";import{C as w,b as M}from"./card-CjYhmd1s.js";import{T as me,a as pe,b as R,c as p,d as xe,e as x,H as Ge}from"./table-BNcgexf8.js";import{u as Xe,b as Ze,a as he}from"./useCustomQuery-Drtt0bmr.js";import{S as Y}from"./separator-BqncX2Xy.js";import{S}from"./SkeletonLoader-DRWOXZAj.js";import{I as ea}from"./Image-Cn_wY8YA.js";import{O as aa}from"./OverLayLoader-BABs976A.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./module-C_OdpX1i.js";const ta="AlertDialog",[sa,za]=Ye(ta,[fe]),u=fe(),oa=a=>{const{__scopeAlertDialog:d,...o}=a,r=u(d);return n.createElement(Oe,f({},r,o,{modal:!0}))},da=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,t=u(o);return n.createElement(Le,f({},t,r,{ref:d}))}),ra=a=>{const{__scopeAlertDialog:d,...o}=a,r=u(d);return n.createElement(Ie,f({},r,o))},na=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,t=u(o);return n.createElement(Se,f({},t,r,{ref:d}))}),$e="AlertDialogContent",[la,ca]=sa($e),ia=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,children:r,...t}=a,i=u(o),b=n.useRef(null),l=ue(d,b),_=n.useRef(null);return n.createElement(Pe,{contentName:$e,titleName:ma,docsSlug:"alert-dialog"},n.createElement(la,{scope:o,cancelRef:_},n.createElement(qe,f({role:"alertdialog"},i,t,{ref:l,onOpenAutoFocus:Ee(t.onOpenAutoFocus,g=>{var $;g.preventDefault(),($=_.current)===null||$===void 0||$.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault()}),n.createElement(Ue,null,r),!1)))}),ma="AlertDialogTitle",pa=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,t=u(o);return n.createElement(ke,f({},t,r,{ref:d}))}),xa=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,t=u(o);return n.createElement(Te,f({},t,r,{ref:d}))}),ha=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,t=u(o);return n.createElement(be,f({},t,r,{ref:d}))}),fa="AlertDialogCancel",ua=n.forwardRef((a,d)=>{const{__scopeAlertDialog:o,...r}=a,{cancelRef:t}=ca(fa,o),i=u(o),b=ue(d,t);return n.createElement(be,f({},i,r,{ref:b}))}),ba=oa,ja=da,ga=ra,Ne=na,ye=ia,Ae=ha,ve=ua,De=pa,we=xa,$a=ba,Na=ja,ya=ga,Me=n.forwardRef(({className:a,...d},o)=>e.jsx(Ne,{className:D("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...d,ref:o}));Me.displayName=Ne.displayName;const _e=n.forwardRef(({className:a,...d},o)=>e.jsxs(ya,{children:[e.jsx(Me,{}),e.jsx(ye,{ref:o,className:D("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d})]}));_e.displayName=ye.displayName;const Ce=n.forwardRef(({className:a,...d},o)=>e.jsx(De,{ref:o,className:D("text-lg font-semibold",a),...d}));Ce.displayName=De.displayName;const Aa=n.forwardRef(({className:a,...d},o)=>e.jsx(we,{ref:o,className:D("text-sm text-muted-foreground",a),...d}));Aa.displayName=we.displayName;const va=n.forwardRef(({className:a,...d},o)=>e.jsx(Ae,{ref:o,className:D(je(),a),...d}));va.displayName=Ae.displayName;const Re=n.forwardRef(({className:a,...d},o)=>e.jsx(ve,{ref:o,className:D(je({variant:"outline"}),"mt-2 sm:mt-0",a),...d}));Re.displayName=ve.displayName;function Da({children:a,buttonTitle:d,title:o}){return e.jsxs($a,{children:[e.jsx(Na,{asChild:!0,children:e.jsx(ge,{variant:"outline",size:"sm",children:d??"Open"})}),e.jsxs(_e,{className:"rounded-lg w-[95%] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ce,{children:o??"Alert Dialog Title"}),e.jsx(Re,{className:"w-8 h-8 px-2 rounded-lg hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l3.293-3.293 1.414 1.414L11.414 10l3.293 3.293-1.414 1.414L10 11.414l-3.293 3.293-1.414-1.414L8.586 10 5.293 6.707l1.414-1.414L10 8.586z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"py-2 overflow-scroll",children:a})]})]})}const wa=Ve().shape({paymentMode:m().required("Payment mode is required"),paidUpto:m().required("Payment amount is required"),bankName:m().when("paymentMode",{is:a=>a=="Cheque"||a=="Dd",then:()=>m().required("Bank name is required")}),branchName:m().when("paymentMode",{is:a=>a=="Cheque"||a=="Dd",then:()=>m().required("Branch name is required")}),chequeDate:m().when("paymentMode",{is:a=>a=="Cheque"||a=="Dd",then:()=>m().required("Cheque/DD date is required")}),chequeNo:m().when("paymentMode",{is:a=>a=="Cheque"||a=="Dd",then:()=>m().required("Cheque/DD number is required")})});function Ha(){var $,P,q,E,U,k,T,I,O,L,B,F,z,H,V,W,Q,J,K,G;const a=We(),{mutateAsync:d,isPending:o}=Xe({}),{id:r}=Qe(),t=Ze({api:`${A.getApartmentDetailsById}/${r}`,options:{enabled:!!r}}),i=Fe({resolver:ze(wa)}),b=he({api:A.getPaymentData,config:{apartmentId:r},options:{enabled:!!r}}),l=he({api:A.getCalculatedAmount,config:{apartmentId:r,payUpto:i.watch("paidUpto")},value:[i.watch("paidUpto")],options:{enabled:!!i.watch("paidUpto")&&!!r}}),_=async s=>{Be("Are you sure to pay?","Please confirm",async()=>{var N,C,h,y,X,Z,ee,ae,te,se,oe,de,re;try{if((s==null?void 0:s.paymentMode)=="Card"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(C=(N=l.data)==null?void 0:N.data)==null?void 0:C.totaldemand,apartmentId:r,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:ne+A.apartmentPayment,token:localStorage.getItem("token"),redirectUrl:le+"/deoghar-app/payment-receipt",payload:{apartmentId:r,paidAmount:(h=l.data)==null?void 0:h.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}}}));return}if((s==null?void 0:s.paymentMode)=="QR"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(X=(y=l.data)==null?void 0:y.data)==null?void 0:X.totaldemand,apartmentId:r,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:ne+A.apartmentPayment,token:localStorage.getItem("token"),redirectUrl:le+"/deoghar-app/payment-receipt",payload:{apartmentId:r,paidAmount:(Z=l.data)==null?void 0:Z.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}}}));return}else{const c=await d({api:A.apartmentPayment,data:s.paymentMode==="Cash"?{apartmentId:r,paidAmount:(ee=l.data)==null?void 0:ee.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}:{apartmentId:r,paidAmount:(ae=l.data)==null?void 0:ae.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto,bankName:s.bankName,branchName:s.branchName,chequeNo:s.chequeNo,chequeDate:s.chequeDate}});(te=c==null?void 0:c.data)!=null&&te.status?(ce.success((se=c==null?void 0:c.data)==null?void 0:se.msg),a(`/deoghar-app/payment-receipt/${(de=(oe=c==null?void 0:c.data)==null?void 0:oe.data)==null?void 0:de.transactionNo}`,{replace:!0})):ce.error((re=c==null?void 0:c.data)==null?void 0:re.msg)}}catch{}})},g=(s,N)=>{const C=s==null?void 0:s.reduce((h,y)=>h+Number(y.total_tax),0);return e.jsx(Da,{title:`${N}-(${C})`,buttonTitle:"View",children:e.jsx("div",{className:"h-96",children:e.jsxs(me,{children:[e.jsx(pe,{children:e.jsxs(R,{children:[e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"})]})}),e.jsx(xe,{children:s==null?void 0:s.map((h,y)=>e.jsxs(R,{children:[e.jsx(x,{children:v(h.payment_from,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:v(h.payment_to,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:h.total_tax}),e.jsx(x,{children:h.paid_status=="0"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},y+1))})]})})})};return t!=null&&t.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(w,{children:e.jsxs(M,{children:[e.jsx(S,{}),e.jsx(S,{}),e.jsx(S,{})]})})}):e.jsxs(Ke,{title:"Apartment Payment",children:[o&&e.jsx(aa,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(ea,{src:"/assets/image/apartment.png",alt:"Add Consumer",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:" font-semibold",children:"Apartment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solid waste management reminder list."})]})]}),e.jsx(Y,{}),e.jsx(w,{children:e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment code:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=($=t==null?void 0:t.data)==null?void 0:$.data[0])==null?void 0:P.apartmentCode})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(E=(q=t==null?void 0:t.data)==null?void 0:q.data[0])==null?void 0:E.apartmentName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mobile no:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(k=(U=t==null?void 0:t.data)==null?void 0:U.data[0])==null?void 0:k.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(T=t==null?void 0:t.data)==null?void 0:T.totalAptMonthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=t==null?void 0:t.data)==null?void 0:I.totalAptDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Total flats:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:L.length})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=(B=t==null?void 0:t.data)==null?void 0:B.data[0])==null?void 0:F.address})})]})})}),e.jsx(Y,{}),((z=t==null?void 0:t.data)==null?void 0:z.totalAptDemand)>0?e.jsxs(Je.Fragment,{children:[e.jsx(w,{children:e.jsx(M,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(Y,{}),e.jsx("div",{children:e.jsxs(me,{children:[e.jsx(pe,{children:e.jsxs(R,{children:[e.jsx(p,{children:"Consumer"}),e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(xe,{children:(W=(V=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:V.filter(s=>s.paidStatus!=="Paid"))==null?void 0:W.map((s,N)=>e.jsxs(R,{children:[e.jsx(x,{children:s.consumerName}),e.jsx(x,{children:v(s.demandFrom,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:v(s.demandUpto,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:s.totaldemand}),e.jsx(x,{children:s.paidStatus=="Unpaid"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})}),e.jsx(x,{children:g(s==null?void 0:s.activeDemandDetails,s.consumerName)})]},N+1))})]})})]})})}),e.jsx(Y,{}),e.jsx(w,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(M,{children:e.jsxs(He,{methods:i,onSubmit:i.handleSubmit(_),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(ie,{name:"paidUpto",label:"Payment Amount",className:"w-full",data:((K=(J=(Q=b==null?void 0:b.data)==null?void 0:Q.data)==null?void 0:J.demand)==null?void 0:K.map(s=>({label:String(s.payment_to),value:String(s.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(ie,{name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(j,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{type:"date",min:v().format("YYYY-MM-DD"),name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(j,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeDate",min:v().format("YYYY-MM-DD"),type:"date",label:"DD Date",className:"w-full"})})]})}[i.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(ge,{type:"submit",className:"mx-auto",disabled:l.isLoading||b.isLoading,children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),l!=null&&l.isLoading?"Calculating...":`Pay Now â‚¹ ${((G=l.data)==null?void 0:G.data.totaldemand)??0}`]})})]})})})]}):e.jsx(w,{children:e.jsx(M,{children:e.jsx("div",{className:"py-2 flex justify-center items-center mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{Ha as default};
