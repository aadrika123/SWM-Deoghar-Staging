import{u as Qe,h as Ve,g as Te,e as c,j as e,I as Je,B as Ke,C as ze,k as De,F as Oe,_ as Le}from"./index-Ba4qy6ke.js";import{h as Ye}from"./moment-CbGOrKEH.js";import{u as Ge,F as Xe,c as Ze,a as l,o as ea}from"./switch-B9ojvj0b.js";import{R as o}from"./RHFTextField-Dx-yFQQV.js";import{e as aa,i as da}from"./router-BsPcvcg3.js";import{R as He}from"./SelectField-CmvPK0as.js";import{P as ta}from"./index-BGr8XjQT.js";import{C as p,b as j}from"./card-C3NmX-Ws.js";import{T as sa,a as na,b as Ee,c as N,d as ia,e as y,H as ra}from"./table-DSR1_Tdb.js";import{S as b}from"./separator-C5osby2u.js";import{S as g}from"./SkeletonLoader-By_dBrWb.js";import{O as la}from"./OverLayLoader-CKL-Apxd.js";import"./headlessui-DAvslveC.js";import"./axios-BrYcoDUu.js";import"./module-9eo5_Hkl.js";const oa=Ze().shape({paymentMode:l().required("Payment mode is required"),paidUpto:l().required("Payment amount is required"),bankName:l().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>l().required("Bank name is required")}),branchName:l().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>l().required("Branch name is required")}),chequeDate:l().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>l().required("Cheque/DD date is required")}),chequeNo:l().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>l().required("Cheque/DD number is required")})});function Ca(){var q,w,C,M,R,U,I,k,S,_,P,A,F,B,T,D,O,L,Y,H,E,$,W,Q,V,J,K,z,G,X,Z,ee,ae,de,te,se,ne,ie,re,le,oe,me,ce,he,xe,pe,je;const s=aa(),{mutateAsync:f,isLoading:$e}=Qe({}),{id:n}=da(),a=Ve({api:"".concat(c.getConsumerDetailsById,"/").concat(n),options:{enabled:!!n}}),h=Ge({resolver:ea(oa)}),u=Te({api:c.getPaymentData,config:{consumerId:n},options:{enabled:!!n}}),i=Te({api:c.getCalculatedAmount,config:{consumerId:n,payUpto:h.watch("paidUpto")},value:[h.watch("paidUpto")],options:{enabled:!!h.watch("paidUpto")&&!!n}}),v=async()=>{var d,m,x;try{const r=await f({api:c.generateOrder,data:{amount:(m=(d=i.data)==null?void 0:d.data)==null?void 0:m.totaldemand,consumerId:n,consumerType:"consumer"}});return(x=r==null?void 0:r.data)!=null&&x.status,r}catch(r){return r}},We=async d=>{ze("Are you sure to pay?","Please confirm",async()=>{var m,x,r,ue,Ne,ye,be,ge,fe,ve,qe,we,Ce,Me,Re,Ue,Ie,ke,Se,_e,Pe,Ae,Fe,Be;try{if((d==null?void 0:d.paymentMode)=="Card"){if(window.ReactNativeWebView){const t=await v();(m=t==null?void 0:t.data)!=null&&m.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(r=(x=i.data)==null?void 0:x.data)==null?void 0:r.totaldemand,consumerId:n,paidUpto:d.paidUpto,paymentMode:d.paymentMode,api:De+c.addOrder,token:localStorage.getItem("token"),tranId:(Ne=(ue=t.data)==null?void 0:ue.data)==null?void 0:Ne.order_id,redirectUrl:Oe+"/deoghar-app/payment-receipt",payload:{amount:(be=(ye=i.data)==null?void 0:ye.data)==null?void 0:be.totaldemand,consumerId:n,consumerType:"consumer",orderId:(fe=(ge=t.data)==null?void 0:ge.data)==null?void 0:fe.order_id,payUpto:d.paidUpto}}}))}return}if((d==null?void 0:d.paymentMode)=="QR"){if(window!=null&&window.ReactNativeWebView){const t=await v();(ve=t==null?void 0:t.data)!=null&&ve.status&&((Se=window==null?void 0:window.ReactNativeWebView)==null||Se.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(we=(qe=i.data)==null?void 0:qe.data)==null?void 0:we.totaldemand,consumerId:n,paidUpto:d.paidUpto,paymentMode:d.paymentMode,api:De+c.addOrder,tranId:(Me=(Ce=t.data)==null?void 0:Ce.data)==null?void 0:Me.order_id,token:localStorage.getItem("token"),redirectUrl:Oe+"/deoghar-app/payment-receipt",payload:{amount:(Ue=(Re=i.data)==null?void 0:Re.data)==null?void 0:Ue.totaldemand,consumerId:n,consumerType:"consumer",orderId:(ke=(Ie=t.data)==null?void 0:Ie.data)==null?void 0:ke.order_id,payUpto:d.paidUpto}}})))}return}else{const t=await f({api:c.postPayment,data:d.paymentMode==="Cash"?{consumerId:n,paidAmount:(_e=i.data)==null?void 0:_e.data.totaldemand,paymentMode:d.paymentMode,paidUpto:d.paidUpto}:{consumerId:n,paidAmount:(Pe=i.data)==null?void 0:Pe.data.totaldemand,paymentMode:d.paymentMode,paidUpto:d.paidUpto,bankName:d.bankName,branchName:d.branchName,chequeNo:d.chequeNo,chequeDate:d.chequeDate}});(Ae=t==null?void 0:t.data)!=null&&Ae.status?(Le.success(t==null?void 0:t.data.msg),s("/deoghar-app/payment-receipt/".concat((Be=(Fe=t==null?void 0:t.data)==null?void 0:Fe.data)==null?void 0:Be.transactionNo),{replace:!0})):Le.error(t==null?void 0:t.data.msg)}}catch(t){}})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(p,{children:e.jsxs(j,{children:[e.jsx(g,{}),e.jsx(g,{}),e.jsx(g,{})]})})}):e.jsxs(ta,{title:"Consumer Payment",children:[$e&&e.jsx(la,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(Je,{src:"/assets/image/category.png",alt:"Consumer Payment",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Consumer Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Consumer payment details here."})]})]}),e.jsx(b,{}),e.jsx(p,{children:e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(w=(q=a==null?void 0:a.data)==null?void 0:q.data[0])==null?void 0:w.consumerNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(M=(C=a==null?void 0:a.data)==null?void 0:C.data[0])==null?void 0:M.consumerName})}),((U=(R=a==null?void 0:a.data)==null?void 0:R.data[0])==null?void 0:U.holdingNo)!=""&&((k=(I=a==null?void 0:a.data)==null?void 0:I.data[0])==null?void 0:k.holdingNo)!=null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding No:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(_=(S=a==null?void 0:a.data)==null?void 0:S.data[0])==null?void 0:_.holdingNo)!=null?P:"--"})})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Mobile:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=(A=a==null?void 0:a.data)==null?void 0:A.data[0])==null?void 0:F.mobileNo})}),((T=(B=a==null?void 0:a.data)==null?void 0:B.data[0])==null?void 0:T.monthlyDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(O=(D=a==null?void 0:a.data)==null?void 0:D.data[0])==null?void 0:O.monthlyDemand})})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(Y=(L=a==null?void 0:a.data)==null?void 0:L.data[0])==null?void 0:Y.totalDemand})}),((E=(H=a==null?void 0:a.data)==null?void 0:H.data[0])==null?void 0:E.totalDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(W=($=a==null?void 0:a.data)==null?void 0:$.data[0])==null?void 0:W.demandFrom})})]}),((V=(Q=a==null?void 0:a.data)==null?void 0:Q.data[0])==null?void 0:V.totalDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(K=(J=a==null?void 0:a.data)==null?void 0:J.data[0])==null?void 0:K.demandUpto})})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer type:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(G=(z=a==null?void 0:a.data)==null?void 0:z.data[0])==null?void 0:G.cansumerType})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(Z=(X=a==null?void 0:a.data)==null?void 0:X.data[0])==null?void 0:Z.Address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply Date:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(ae=(ee=a==null?void 0:a.data)==null?void 0:ee.data[0])==null?void 0:ae.applyDate})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply By:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(te=(de=a==null?void 0:a.data)==null?void 0:de.data[0])==null?void 0:te.applyBy})})]})})}),e.jsx(b,{}),((ie=(ne=(se=a==null?void 0:a.data)==null?void 0:se.data[0])==null?void 0:ne.activeDemandDetails)==null?void 0:ie.length)>0?e.jsxs(e.Fragment,{children:[" ",e.jsx(p,{children:e.jsx(j,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(b,{}),e.jsx("div",{children:e.jsxs(sa,{children:[e.jsx(na,{children:e.jsxs(Ee,{children:[e.jsx(N,{children:"Demand from"}),e.jsx(N,{children:"Demand upto"}),e.jsx(N,{children:"Amount"}),e.jsx(N,{children:"Status"})]})}),e.jsx(ia,{children:(oe=(le=(re=a==null?void 0:a.data)==null?void 0:re.data[0])==null?void 0:le.activeDemandDetails)==null?void 0:oe.map((d,m)=>e.jsxs(Ee,{children:[e.jsx(y,{children:Ye(d.payment_from).format("DD-MMM-YYYY")}),e.jsx(y,{children:Ye(d.payment_to).format("DD-MMM-YYYY")}),e.jsx(y,{children:d.total_tax}),e.jsx(y,{children:d.paid_status==0?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},m+1))})]})})]})})}),e.jsx(b,{}),e.jsx(p,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(j,{children:e.jsxs(Xe,{methods:h,onSubmit:h.handleSubmit(We),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(He,{isRequired:!0,name:"paidUpto",label:"Payment upto month",className:"w-full",data:(xe=(he=(ce=(me=u==null?void 0:u.data)==null?void 0:me.data)==null?void 0:ce.demand)==null?void 0:he.map(d=>({label:String(d.payment_to),value:String(d.payment_to)})))!=null?xe:[]})}),e.jsx("div",{children:e.jsx(He,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,type:"date",name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeDate",type:"date",label:"DD Date",className:"w-full"})})]})}[h.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(Ke,{type:"submit",className:"mx-auto",disabled:i.isLoading||u.isLoading,children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),i!=null&&i.isLoading?"Calculating...":"Pay Now â‚¹ ".concat((je=(pe=i.data)==null?void 0:pe.data.totaldemand)!=null?je:0)]})})]})})})]}):e.jsx(p,{children:e.jsx(j,{children:e.jsx("div",{className:"py-2 flex justify-center items-center",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{Ca as default};
