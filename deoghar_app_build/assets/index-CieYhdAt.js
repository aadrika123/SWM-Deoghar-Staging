import{h as Ae,i as le,k as we,l as b,m as ce,n as De,o as _e,p as Me,q as Ye,r as Re,s as Ce,t as ie,v as Pe,w as Se,x as Ee,j as e,y as A,g as R,_ as te}from"./index-D9SUnkI2.js";import{h as v}from"./moment-BjLXg0w5.js";import{a as qe,o as Te,F as Oe,S as se,c as Ue,b as x}from"./SelectField-WJfBqNjK.js";import{R as g}from"./RHFTextField-BdHjFRnA.js";import{b as me,B as xe}from"./button-IjAY8dzr.js";import{r,b as ke,f as Le,R as Fe}from"./router-DQohkvhc.js";import{P as Ie}from"./index-BhPwl-Wc.js";import{C as M,b as Y}from"./card-BocCdTs6.js";import{T as oe,a as ne,b as C,c as p,d as de,e as f,H as Be}from"./table-CvgRke4_.js";import{u as ze,b as He,a as re}from"./useCustomQuery-DgvKAbQU.js";import{S as P}from"./separator-ZtTJhbg_.js";import{S}from"./SkeletonLoader-wDDYqom2.js";import{I as Ve}from"./Image-C1TMCRx8.js";import{O as We}from"./OverLayLoader-B_NdIHLb.js";import{C as Qe}from"./index-DIInLEzD.js";import"./headlessui-qWRqSxHB.js";import"./axios-DmypytPv.js";import"./module-CLOPZauA.js";const Je="AlertDialog",[Ke,Ua]=Ae(Je,[le]),j=le(),Ge=o=>{const{__scopeAlertDialog:n,...s}=o,d=j(n);return r.createElement(Se,b({},d,s,{modal:!0}))},Xe=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,a=j(s);return r.createElement(Ee,b({},a,d,{ref:n}))}),Ze=o=>{const{__scopeAlertDialog:n,...s}=o,d=j(n);return r.createElement(Pe,b({},d,s))},ea=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,a=j(s);return r.createElement(we,b({},a,d,{ref:n}))}),pe="AlertDialogContent",[aa,ta]=Ke(pe),sa=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,children:d,...a}=o,m=j(s),$=r.useRef(null),c=ce(n,$),w=r.useRef(null);return r.createElement(De,{contentName:pe,titleName:oa,docsSlug:"alert-dialog"},r.createElement(aa,{scope:s,cancelRef:w},r.createElement(_e,b({role:"alertdialog"},m,a,{ref:c,onOpenAutoFocus:Me(a.onOpenAutoFocus,N=>{var D;N.preventDefault(),(D=w.current)===null||D===void 0||D.focus({preventScroll:!0})}),onPointerDownOutside:N=>N.preventDefault(),onInteractOutside:N=>N.preventDefault()}),r.createElement(Ye,null,d),!1)))}),oa="AlertDialogTitle",na=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,a=j(s);return r.createElement(Re,b({},a,d,{ref:n}))}),da=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,a=j(s);return r.createElement(Ce,b({},a,d,{ref:n}))}),ra=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,a=j(s);return r.createElement(ie,b({},a,d,{ref:n}))}),la="AlertDialogCancel",ca=r.forwardRef((o,n)=>{const{__scopeAlertDialog:s,...d}=o,{cancelRef:a}=ta(la,s),m=j(s),$=ce(n,a);return r.createElement(ie,b({},m,d,{ref:$}))}),ia=Ge,ma=Xe,xa=Ze,fe=ea,he=sa,ue=ra,be=ca,je=na,$e=da,pa=ia,fa=ma,ha=xa,ge=r.forwardRef(({className:o,...n},s)=>e.jsx(fe,{className:A("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...n,ref:s}));ge.displayName=fe.displayName;const Ne=r.forwardRef(({className:o,...n},s)=>e.jsxs(ha,{children:[e.jsx(ge,{}),e.jsx(he,{ref:s,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...n})]}));Ne.displayName=he.displayName;const ye=r.forwardRef(({className:o,...n},s)=>e.jsx(je,{ref:s,className:A("text-lg font-semibold",o),...n}));ye.displayName=je.displayName;const ua=r.forwardRef(({className:o,...n},s)=>e.jsx($e,{ref:s,className:A("text-sm text-muted-foreground",o),...n}));ua.displayName=$e.displayName;const ba=r.forwardRef(({className:o,...n},s)=>e.jsx(ue,{ref:s,className:A(me(),o),...n}));ba.displayName=ue.displayName;const ve=r.forwardRef(({className:o,...n},s)=>e.jsx(be,{ref:s,className:A(me({variant:"outline"}),"mt-2 sm:mt-0",o),...n}));ve.displayName=be.displayName;function ja({children:o,buttonTitle:n,title:s}){return e.jsxs(pa,{children:[e.jsx(fa,{asChild:!0,children:e.jsx(xe,{variant:"outline",size:"sm",children:n??"Open"})}),e.jsxs(Ne,{className:"rounded-lg w-[95%] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ye,{children:s??"Alert Dialog Title"}),e.jsx(ve,{className:"w-8 h-8 px-2 rounded-lg hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l3.293-3.293 1.414 1.414L11.414 10l3.293 3.293-1.414 1.414L10 11.414l-3.293 3.293-1.414-1.414L8.586 10 5.293 6.707l1.414-1.414L10 8.586z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"py-2 overflow-scroll",children:o})]})]})}const $a=Ue().shape({paymentMode:x().required("Payment mode is required"),paidUpto:x().required("Payment amount is required"),bankName:x().when("paymentMode",{is:"Dd",then:()=>x()}),branchName:x().when("paymentMode",{is:"Dd",then:()=>x()}),chequeDate:x().when("paymentMode",{is:"Dd",then:()=>x()}),chequeNo:x().when("paymentMode",{is:"Dd",then:()=>x()})});function ka(){var E,q,T,O,U,k,L,F,I,B,z,H,V,W,Q,J,K,G,X,Z;const o=ke(),{mutateAsync:n,isPending:s}=ze({}),{id:d}=Le(),a=He({api:`${R.getApartmentDetailsById}/${d}`,options:{enabled:!!d}}),m=qe({resolver:Te($a)}),$=re({api:R.getPaymentData,config:{apartmentId:d},options:{enabled:!!d}}),c=re({api:R.getCalculatedAmount,config:{apartmentId:d,payUpto:m.watch("paidUpto")},value:[m.watch("paidUpto")],options:{enabled:!!m.watch("paidUpto")&&!!d}}),w=()=>{var t,h,y,i,u,_;return((h=(t=c.data)==null?void 0:t.data)==null?void 0:h.totaldemand)<"100"?((i=(y=c.data)==null?void 0:y.data)==null?void 0:i.totaldemand)*10:(_=(u=c.data)==null?void 0:u.data)==null?void 0:_.totaldemand},N=async t=>{Qe("Are you sure to pay?","Please confirm",async()=>{var h,y,i,u,_,ee,ae;try{if((t==null?void 0:t.paymentMode)=="Online"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:w(),apartmentId:d,paidUpto:t.paidUpto,paymentMode:t.paymentMode}}));return}if((t==null?void 0:t.paymentMode)=="QR"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:w(),apartmentId:d,paidUpto:t.paidUpto,paymentMode:t.paymentMode}}));return}else{const l=await n({api:R.apartmentPayment,data:t.paymentMode==="Cash"?{apartmentId:d,paidAmount:(h=c.data)==null?void 0:h.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto}:{apartmentId:d,paidAmount:(y=c.data)==null?void 0:y.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto,bankName:t.bankName,branchName:t.branchName,chequeNo:t.chequeNo,chequeDate:t.chequeDate}});(i=l==null?void 0:l.data)!=null&&i.status?(te.success((u=l==null?void 0:l.data)==null?void 0:u.msg),o(`/deoghar-app/payment-receipt/${(ee=(_=l==null?void 0:l.data)==null?void 0:_.data)==null?void 0:ee.transactionNo}`,{replace:!0})):te.error((ae=l==null?void 0:l.data)==null?void 0:ae.msg)}}catch{}})},D=(t,h)=>{const y=t==null?void 0:t.reduce((i,u)=>i+Number(u.total_tax),0);return e.jsx(ja,{title:`${h}-(${y})`,buttonTitle:"View",children:e.jsx("div",{className:"h-96",children:e.jsxs(oe,{children:[e.jsx(ne,{children:e.jsxs(C,{children:[e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"})]})}),e.jsx(de,{children:t==null?void 0:t.map((i,u)=>e.jsxs(C,{children:[e.jsx(f,{children:v(i.payment_from,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:v(i.payment_to,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:i.total_tax}),e.jsx(f,{children:i.paid_status=="0"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},u+1))})]})})})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(M,{children:e.jsxs(Y,{children:[e.jsx(S,{}),e.jsx(S,{}),e.jsx(S,{})]})})}):e.jsxs(Ie,{title:"Apartment Payment",children:[s&&e.jsx(We,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(Ve,{src:"/assets/image/apartment.png",alt:"Add Consumer",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:" font-semibold",children:"Apartment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solid waste management reminder list."})]})]}),e.jsx(P,{}),e.jsx(M,{children:e.jsx(Y,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment code:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(q=(E=a==null?void 0:a.data)==null?void 0:E.data[0])==null?void 0:q.apartmentCode})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(O=(T=a==null?void 0:a.data)==null?void 0:T.data[0])==null?void 0:O.apartmentName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mobile no:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(k=(U=a==null?void 0:a.data)==null?void 0:U.data[0])==null?void 0:k.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=a==null?void 0:a.data)==null?void 0:L.totalAptMonthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=a==null?void 0:a.data)==null?void 0:F.totalAptDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Total flats:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=(I=a==null?void 0:a.data)==null?void 0:I.data)==null?void 0:B.length})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(H=(z=a==null?void 0:a.data)==null?void 0:z.data[0])==null?void 0:H.address})})]})})}),e.jsx(P,{}),((V=a==null?void 0:a.data)==null?void 0:V.totalAptDemand)>0?e.jsxs(Fe.Fragment,{children:[e.jsx(M,{children:e.jsx(Y,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(P,{}),e.jsx("div",{children:e.jsxs(oe,{children:[e.jsx(ne,{children:e.jsxs(C,{children:[e.jsx(p,{children:"Consumer"}),e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(de,{children:(J=(Q=(W=a==null?void 0:a.data)==null?void 0:W.data)==null?void 0:Q.filter(t=>t.paidStatus!=="Paid"))==null?void 0:J.map((t,h)=>e.jsxs(C,{children:[e.jsx(f,{children:t.consumerName}),e.jsx(f,{children:v(t.demandFrom,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:v(t.demandUpto,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:t.totaldemand}),e.jsx(f,{children:t.paidStatus=="Unpaid"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})}),e.jsx(f,{children:D(t==null?void 0:t.activeDemandDetails,t.consumerName)})]},h+1))})]})})]})})}),e.jsx(P,{}),e.jsx(M,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(Y,{children:e.jsxs(Oe,{methods:m,onSubmit:m.handleSubmit(N),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(se,{name:"paidUpto",label:"Payment Amount",className:"w-full",data:((X=(G=(K=$==null?void 0:$.data)==null?void 0:K.data)==null?void 0:G.demand)==null?void 0:X.map(t=>({label:String(t.payment_to),value:String(t.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(se,{name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Online",value:"Online"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(g,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{type:"date",min:v().format("YYYY-MM-DD"),name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(g,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{name:"chequeDate",min:v().format("YYYY-MM-DD"),type:"date",label:"DD Date",className:"w-full"})})]})}[m.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(xe,{type:"submit",className:"mx-auto",disabled:c.isLoading||$.isLoading,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),c!=null&&c.isLoading?"Calculating...":`Pay Now â‚¹ ${((Z=c.data)==null?void 0:Z.data.totaldemand)??0}`]})})]})})})]}):e.jsx(M,{children:e.jsx(Y,{children:e.jsx("div",{className:"py-2 flex justify-center items-center mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{ka as default};
