import{l as Je,m as Se,n as Ke,o as j,p as Pe,q as Xe,r as Ze,s as ea,t as aa,v as ta,w as sa,x as Ue,y as da,z as ra,A as oa,j as e,D,G as Ee,B as Te,u as na,H as ca,h as la,g as we,e as y,I as ia,C as ma,k as De,F as _e,_ as Me}from"./index-DXnQFv5m.js";import{h as w}from"./moment-BjLXg0w5.js";import{u as xa,o as pa,F as ha,S as Re,c as fa,a as p}from"./SelectField-CUeDHv1Q.js";import{R as $}from"./RHFTextField-CTpT65iJ.js";import{r as n,d as ua,h as ja,R as ba}from"./router-CTqkcgir.js";import{P as ga}from"./index-DH8Fu2_e.js";import{C as M,b as R}from"./card-ns1-LEZF.js";import{T as qe,a as Ce,b as q,c as h,d as Ye,e as f,H as $a}from"./table-BUrmW3wL.js";import{S as C}from"./separator-DGbOHHaC.js";import{S as Y}from"./SkeletonLoader-CDE_OKo7.js";import{O as Na}from"./OverLayLoader-Cmg21mok.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./module-B3gLIaAf.js";const ya="AlertDialog",[Aa,nt]=Je(ya,[Se]),b=Se(),va=s=>{const{__scopeAlertDialog:r,...d}=s,l=b(r);return n.createElement(ra,j({},l,d,{modal:!0}))},wa=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,o=b(d);return n.createElement(oa,j({},o,l,{ref:r}))}),Da=s=>{const{__scopeAlertDialog:r,...d}=s,l=b(r);return n.createElement(da,j({},l,d))},_a=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,o=b(d);return n.createElement(Ke,j({},o,l,{ref:r}))}),Ie="AlertDialogContent",[Ma,Ra]=Aa(Ie),qa=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,children:l,...o}=s,a=b(d),x=n.useRef(null),A=Pe(r,x),m=n.useRef(null);return n.createElement(Xe,{contentName:Ie,titleName:Ca,docsSlug:"alert-dialog"},n.createElement(Ma,{scope:d,cancelRef:m},n.createElement(Ze,j({role:"alertdialog"},a,o,{ref:A,onOpenAutoFocus:ea(o.onOpenAutoFocus,g=>{var _;g.preventDefault(),(_=m.current)===null||_===void 0||_.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault()}),n.createElement(aa,null,l),!1)))}),Ca="AlertDialogTitle",Ya=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,o=b(d);return n.createElement(ta,j({},o,l,{ref:r}))}),Sa=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,o=b(d);return n.createElement(sa,j({},o,l,{ref:r}))}),Pa=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,o=b(d);return n.createElement(Ue,j({},o,l,{ref:r}))}),Ua="AlertDialogCancel",Ea=n.forwardRef((s,r)=>{const{__scopeAlertDialog:d,...l}=s,{cancelRef:o}=Ra(Ua,d),a=b(d),x=Pe(r,o);return n.createElement(Ue,j({},a,l,{ref:x}))}),Ta=va,Ia=wa,ka=Da,ke=_a,Oe=qa,Fe=Pa,Le=Ea,Be=Ya,ze=Sa,Oa=Ta,Fa=Ia,La=ka,He=n.forwardRef(({className:s,...r},d)=>e.jsx(ke,{className:D("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:d}));He.displayName=ke.displayName;const Ve=n.forwardRef(({className:s,...r},d)=>e.jsxs(La,{children:[e.jsx(He,{}),e.jsx(Oe,{ref:d,className:D("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]}));Ve.displayName=Oe.displayName;const We=n.forwardRef(({className:s,...r},d)=>e.jsx(Be,{ref:d,className:D("text-lg font-semibold",s),...r}));We.displayName=Be.displayName;const Ba=n.forwardRef(({className:s,...r},d)=>e.jsx(ze,{ref:d,className:D("text-sm text-muted-foreground",s),...r}));Ba.displayName=ze.displayName;const za=n.forwardRef(({className:s,...r},d)=>e.jsx(Fe,{ref:d,className:D(Ee(),s),...r}));za.displayName=Fe.displayName;const Qe=n.forwardRef(({className:s,...r},d)=>e.jsx(Le,{ref:d,className:D(Ee({variant:"outline"}),"mt-2 sm:mt-0",s),...r}));Qe.displayName=Le.displayName;function Ha({children:s,buttonTitle:r,title:d}){return e.jsxs(Oa,{children:[e.jsx(Fa,{asChild:!0,children:e.jsx(Te,{variant:"outline",size:"sm",children:r??"Open"})}),e.jsxs(Ve,{className:"rounded-lg w-[95%] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(We,{children:d??"Alert Dialog Title"}),e.jsx(Qe,{className:"w-8 h-8 px-2 rounded-lg hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l3.293-3.293 1.414 1.414L11.414 10l3.293 3.293-1.414 1.414L10 11.414l-3.293 3.293-1.414-1.414L8.586 10 5.293 6.707l1.414-1.414L10 8.586z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"py-2 overflow-scroll",children:s})]})]})}const Va=fa().shape({paymentMode:p().required("Payment mode is required"),paidUpto:p().required("Payment amount is required"),bankName:p().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>p().required("Bank name is required")}),branchName:p().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>p().required("Branch name is required")}),chequeDate:p().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>p().required("Cheque/DD date is required")}),chequeNo:p().when("paymentMode",{is:s=>s=="Cheque"||s=="Dd",then:()=>p().required("Cheque/DD number is required")})});function ct(){var S,P,U,E,T,I,k,O,F,L,B,z,H,V,W,Q,G,J,K,X,Z,ee,ae,te,se,de,re;const s=ua(),{mutateAsync:r,isPending:d}=na({}),{createGeoLocation:l}=ca(),{id:o}=ja(),a=la({api:`${y.getApartmentDetailsById}/${o}`,options:{enabled:!!o}}),x=xa({resolver:pa(Va)}),A=we({api:y.getPaymentData,config:{apartmentId:o},options:{enabled:!!o}}),m=we({api:y.getCalculatedAmount,config:{apartmentId:o,payUpto:x.watch("paidUpto")},value:[x.watch("paidUpto")],options:{enabled:!!x.watch("paidUpto")&&!!o}}),g=async()=>{var t,u,N;try{const i=await r({api:y.generateOrder,data:{amount:(u=(t=m.data)==null?void 0:t.data)==null?void 0:u.totaldemand,consumerId:o,consumerType:"apartment"}});return(N=i==null?void 0:i.data)!=null&&N.status,i}catch(i){return i}},_=async t=>{ma("Are you sure to pay?","Please confirm",async()=>{var u,N,i,v,oe,ne,ce,le,ie,me,xe,pe,he,fe,ue,je,be,ge,$e,Ne,ye,Ae,ve;try{if((t==null?void 0:t.paymentMode)=="Card"){if(window.ReactNativeWebView){const c=await g();(u=c==null?void 0:c.data)!=null&&u.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(i=(N=m.data)==null?void 0:N.data)==null?void 0:i.totaldemand,apartmentId:o,paidUpto:t.paidUpto,paymentMode:t.paymentMode,api:De+y.addOrder,token:localStorage.getItem("token"),tranId:(oe=(v=c.data)==null?void 0:v.data)==null?void 0:oe.order_id,redirectUrl:_e+"/deoghar-app/payment-receipt",payload:{amount:(ce=(ne=m.data)==null?void 0:ne.data)==null?void 0:ce.totaldemand,consumerId:o,consumerType:"apartment",orderId:(ie=(le=c.data)==null?void 0:le.data)==null?void 0:ie.order_id,payUpto:t.paidUpto}}}))}return}if((t==null?void 0:t.paymentMode)=="QR"){if(window.ReactNativeWebView){const c=await g();(me=c==null?void 0:c.data)!=null&&me.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(pe=(xe=m.data)==null?void 0:xe.data)==null?void 0:pe.totaldemand,apartmentId:o,paidUpto:t.paidUpto,paymentMode:t.paymentMode,api:De+y.addOrder,token:localStorage.getItem("token"),redirectUrl:_e+"/deoghar-app/payment-receipt",payload:{amount:(fe=(he=m.data)==null?void 0:he.data)==null?void 0:fe.totaldemand,consumerId:o,consumerType:"apartment",orderId:(je=(ue=c.data)==null?void 0:ue.data)==null?void 0:je.order_id,payUpto:t.paidUpto}}}))}return}else{const c=await r({api:y.apartmentPayment,data:t.paymentMode==="Cash"?{apartmentId:o,paidAmount:(be=m.data)==null?void 0:be.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto}:{apartmentId:o,paidAmount:(ge=m.data)==null?void 0:ge.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto,bankName:t.bankName,branchName:t.branchName,chequeNo:t.chequeNo,chequeDate:t.chequeDate}});($e=c==null?void 0:c.data)!=null&&$e.status?(Me.success((Ne=c==null?void 0:c.data)==null?void 0:Ne.msg),s(`/deoghar-app/payment-receipt/${(Ae=(ye=c==null?void 0:c.data)==null?void 0:ye.data)==null?void 0:Ae.transactionNo}`,{replace:!0})):Me.error((ve=c==null?void 0:c.data)==null?void 0:ve.msg)}await l()}catch{}})},Ge=(t,u)=>{const N=t==null?void 0:t.reduce((i,v)=>i+Number(v.total_tax),0);return e.jsx(Ha,{title:`${u}-(${N})`,buttonTitle:"View",children:e.jsx("div",{className:"h-96",children:e.jsxs(qe,{children:[e.jsx(Ce,{children:e.jsxs(q,{children:[e.jsx(h,{children:"Demand from"}),e.jsx(h,{children:"Demand upto"}),e.jsx(h,{children:"Amount"}),e.jsx(h,{children:"Status"})]})}),e.jsx(Ye,{children:t==null?void 0:t.map((i,v)=>e.jsxs(q,{children:[e.jsx(f,{children:w(i.payment_from,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:w(i.payment_to,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:i.total_tax}),e.jsx(f,{children:i.paid_status=="0"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},v+1))})]})})})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(Y,{}),e.jsx(Y,{}),e.jsx(Y,{})]})})}):e.jsxs(ga,{title:"Apartment Payment",children:[d&&e.jsx(Na,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(ia,{src:"/assets/image/apartment.png",alt:"Add Consumer",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:" font-semibold",children:"Apartment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solid waste management reminder list."})]})]}),e.jsx(C,{}),e.jsx(M,{children:e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment code:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(S=a==null?void 0:a.data)==null?void 0:S.data[0])==null?void 0:P.apartmentCode})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(E=(U=a==null?void 0:a.data)==null?void 0:U.data[0])==null?void 0:E.apartmentName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mobile no:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=(T=a==null?void 0:a.data)==null?void 0:T.data[0])==null?void 0:I.mobileNo})}),((k=a==null?void 0:a.data)==null?void 0:k.totalAptMonthlyDemand)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(O=a==null?void 0:a.data)==null?void 0:O.totalAptMonthlyDemand})})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=a==null?void 0:a.data)==null?void 0:F.totalAptDemand})}),((L=a==null?void 0:a.data)==null?void 0:L.totalAptDemand)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(z=(B=a==null?void 0:a.data)==null?void 0:B.data[0])==null?void 0:z.demandFrom})})]}),((H=a==null?void 0:a.data)==null?void 0:H.totalAptDemand)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(W=(V=a==null?void 0:a.data)==null?void 0:V.data[0])==null?void 0:W.demandUpto})})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Total flats:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(G=(Q=a==null?void 0:a.data)==null?void 0:Q.data)==null?void 0:G.length})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(K=(J=a==null?void 0:a.data)==null?void 0:J.data[0])==null?void 0:K.address})})]})})}),e.jsx(C,{}),((X=a==null?void 0:a.data)==null?void 0:X.totalAptDemand)>0?e.jsxs(ba.Fragment,{children:[e.jsx(M,{children:e.jsx(R,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(C,{}),e.jsx("div",{children:e.jsxs(qe,{children:[e.jsx(Ce,{children:e.jsxs(q,{children:[e.jsx(h,{children:"Consumer"}),e.jsx(h,{children:"Demand from"}),e.jsx(h,{children:"Demand upto"}),e.jsx(h,{children:"Amount"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Action"})]})}),e.jsx(Ye,{children:(ae=(ee=(Z=a==null?void 0:a.data)==null?void 0:Z.data)==null?void 0:ee.filter(t=>t.paidStatus!=="Paid"))==null?void 0:ae.map((t,u)=>e.jsxs(q,{children:[e.jsx(f,{children:t.consumerName}),e.jsx(f,{children:w(t.demandFrom,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:w(t.demandUpto,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(f,{children:t.totaldemand}),e.jsx(f,{children:t.paidStatus=="Unpaid"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})}),e.jsx(f,{children:Ge(t==null?void 0:t.activeDemandDetails,t.consumerName)})]},u+1))})]})})]})})}),e.jsx(C,{}),e.jsx(M,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(R,{children:e.jsxs(ha,{methods:x,onSubmit:x.handleSubmit(_),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(Re,{isRequired:!0,name:"paidUpto",label:"Payment Upto Month",className:"w-full",data:((de=(se=(te=A==null?void 0:A.data)==null?void 0:te.data)==null?void 0:se.demand)==null?void 0:de.map(t=>({label:String(t.payment_to),value:String(t.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(Re,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,type:"date",min:w().format("YYYY-MM-DD"),name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx($,{isRequired:!0,name:"chequeDate",min:w().format("YYYY-MM-DD"),type:"date",label:"DD Date",className:"w-full"})})]})}[x.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(Te,{type:"submit",className:"mx-auto",disabled:m.isLoading||A.isLoading,children:[e.jsx($a,{className:"mr-2 h-4 w-4"}),m!=null&&m.isLoading?"Calculating...":`Pay Now â‚¹ ${((re=m.data)==null?void 0:re.data.totaldemand)??0}`]})})]})})})]}):e.jsx(M,{children:e.jsx(R,{children:e.jsx("div",{className:"py-2 flex justify-center items-center mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{ct as default};
