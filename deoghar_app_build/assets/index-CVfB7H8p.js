import{h as Fe,i as De,k as Be,l as u,m as _e,n as ze,o as He,p as Ve,q as We,r as Qe,s as Je,t as Me,v as Ke,w as Ge,x as Xe,j as e,y as v,z as Re,B as qe,d as y,C as Ze,g as je,F as ge,_ as $e}from"./index-Yny61KPB.js";import{h as w}from"./moment-BjLXg0w5.js";import{u as ea,o as aa,F as ta,S as Ne,c as sa,a as p}from"./SelectField-DnNbu2K3.js";import{R as g}from"./RHFTextField-BruYik0L.js";import{r as n,d as ra,h as da,R as oa}from"./router-CTqkcgir.js";import{P as na}from"./index-INWp6999.js";import{C as M,b as R}from"./card-CVwSjUK5.js";import{T as ye,a as Ae,b as q,c as x,d as we,e as h,H as la}from"./table-CWC4Qzfv.js";import{u as ca,b as ia,a as ve}from"./useCustomQuery-Dk3auMnt.js";import{S as C}from"./separator-C-3fcjsv.js";import{S as Y}from"./SkeletonLoader-BxWD6G2w.js";import{I as ma}from"./Image-BV2YQpvd.js";import{O as pa}from"./OverLayLoader-B3U5tm1A.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./module-BSYmueMN.js";const xa="AlertDialog",[ha,et]=Fe(xa,[De]),b=De(),fa=t=>{const{__scopeAlertDialog:d,...r}=t,o=b(d);return n.createElement(Ge,u({},o,r,{modal:!0}))},ua=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,s=b(r);return n.createElement(Xe,u({},s,o,{ref:d}))}),ba=t=>{const{__scopeAlertDialog:d,...r}=t,o=b(d);return n.createElement(Ke,u({},o,r))},ja=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,s=b(r);return n.createElement(Be,u({},s,o,{ref:d}))}),Ce="AlertDialogContent",[ga,$a]=ha(Ce),Na=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,children:o,...s}=t,m=b(r),j=n.useRef(null),i=_e(d,j),D=n.useRef(null);return n.createElement(ze,{contentName:Ce,titleName:ya,docsSlug:"alert-dialog"},n.createElement(ga,{scope:r,cancelRef:D},n.createElement(He,u({role:"alertdialog"},m,s,{ref:i,onOpenAutoFocus:Ve(s.onOpenAutoFocus,$=>{var _;$.preventDefault(),(_=D.current)===null||_===void 0||_.focus({preventScroll:!0})}),onPointerDownOutside:$=>$.preventDefault(),onInteractOutside:$=>$.preventDefault()}),n.createElement(We,null,o),!1)))}),ya="AlertDialogTitle",Aa=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,s=b(r);return n.createElement(Qe,u({},s,o,{ref:d}))}),wa=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,s=b(r);return n.createElement(Je,u({},s,o,{ref:d}))}),va=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,s=b(r);return n.createElement(Me,u({},s,o,{ref:d}))}),Da="AlertDialogCancel",_a=n.forwardRef((t,d)=>{const{__scopeAlertDialog:r,...o}=t,{cancelRef:s}=$a(Da,r),m=b(r),j=_e(d,s);return n.createElement(Me,u({},m,o,{ref:j}))}),Ma=fa,Ra=ua,qa=ba,Ye=ja,Se=Na,Pe=va,Ee=_a,Ue=Aa,Te=wa,Ca=Ma,Ya=Ra,Sa=qa,Ie=n.forwardRef(({className:t,...d},r)=>e.jsx(Ye,{className:v("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...d,ref:r}));Ie.displayName=Ye.displayName;const ke=n.forwardRef(({className:t,...d},r)=>e.jsxs(Sa,{children:[e.jsx(Ie,{}),e.jsx(Se,{ref:r,className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...d})]}));ke.displayName=Se.displayName;const Oe=n.forwardRef(({className:t,...d},r)=>e.jsx(Ue,{ref:r,className:v("text-lg font-semibold",t),...d}));Oe.displayName=Ue.displayName;const Pa=n.forwardRef(({className:t,...d},r)=>e.jsx(Te,{ref:r,className:v("text-sm text-muted-foreground",t),...d}));Pa.displayName=Te.displayName;const Ea=n.forwardRef(({className:t,...d},r)=>e.jsx(Pe,{ref:r,className:v(Re(),t),...d}));Ea.displayName=Pe.displayName;const Le=n.forwardRef(({className:t,...d},r)=>e.jsx(Ee,{ref:r,className:v(Re({variant:"outline"}),"mt-2 sm:mt-0",t),...d}));Le.displayName=Ee.displayName;function Ua({children:t,buttonTitle:d,title:r}){return e.jsxs(Ca,{children:[e.jsx(Ya,{asChild:!0,children:e.jsx(qe,{variant:"outline",size:"sm",children:d??"Open"})}),e.jsxs(ke,{className:"rounded-lg w-[95%] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Oe,{children:r??"Alert Dialog Title"}),e.jsx(Le,{className:"w-8 h-8 px-2 rounded-lg hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l3.293-3.293 1.414 1.414L11.414 10l3.293 3.293-1.414 1.414L10 11.414l-3.293 3.293-1.414-1.414L8.586 10 5.293 6.707l1.414-1.414L10 8.586z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"py-2 overflow-scroll",children:t})]})]})}const Ta=sa().shape({paymentMode:p().required("Payment mode is required"),paidUpto:p().required("Payment amount is required"),bankName:p().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>p().required("Bank name is required")}),branchName:p().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>p().required("Branch name is required")}),chequeDate:p().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>p().required("Cheque/DD date is required")}),chequeNo:p().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>p().required("Cheque/DD number is required")})});function at(){var S,P,E,U,T,I,k,O,L,F,B,z,H,V,W,Q,J,K,G,X;const t=ra(),{mutateAsync:d,isPending:r}=ca({}),{id:o}=da(),s=ia({api:`${y.getApartmentDetailsById}/${o}`,options:{enabled:!!o}}),m=ea({resolver:aa(Ta)}),j=ve({api:y.getPaymentData,config:{apartmentId:o},options:{enabled:!!o}}),i=ve({api:y.getCalculatedAmount,config:{apartmentId:o,payUpto:m.watch("paidUpto")},value:[m.watch("paidUpto")],options:{enabled:!!m.watch("paidUpto")&&!!o}}),D=async()=>{var a,f,N;try{const c=await d({api:y.generateOrder,data:{amount:(f=(a=i.data)==null?void 0:a.data)==null?void 0:f.totaldemand,consumerId:o,consumerType:"apartment"}});return(N=c==null?void 0:c.data)!=null&&N.status,c}catch(c){return c}},$=async a=>{Ze("Are you sure to pay?","Please confirm",async()=>{var f,N,c,A,Z,ee,ae,te,se,re,de,oe,ne,le,ce,ie,me,pe,xe,he,fe,ue,be;try{if((a==null?void 0:a.paymentMode)=="Card"){if(window.ReactNativeWebView){const l=await D();(f=l==null?void 0:l.data)!=null&&f.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(c=(N=i.data)==null?void 0:N.data)==null?void 0:c.totaldemand,apartmentId:o,paidUpto:a.paidUpto,paymentMode:a.paymentMode,api:je+y.addOrder,token:localStorage.getItem("token"),tranId:(Z=(A=l.data)==null?void 0:A.data)==null?void 0:Z.order_id,redirectUrl:ge+"/deoghar-app/payment-receipt",payload:{amount:(ae=(ee=i.data)==null?void 0:ee.data)==null?void 0:ae.totaldemand,consumerId:o,consumerType:"apartment",orderId:(se=(te=l.data)==null?void 0:te.data)==null?void 0:se.order_id,payUpto:a.paidUpto}}}))}return}if((a==null?void 0:a.paymentMode)=="QR"){if(window.ReactNativeWebView){const l=await D();(re=l==null?void 0:l.data)!=null&&re.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(oe=(de=i.data)==null?void 0:de.data)==null?void 0:oe.totaldemand,apartmentId:o,paidUpto:a.paidUpto,paymentMode:a.paymentMode,api:je+y.addOrder,token:localStorage.getItem("token"),redirectUrl:ge+"/deoghar-app/payment-receipt",payload:{amount:(le=(ne=i.data)==null?void 0:ne.data)==null?void 0:le.totaldemand,consumerId:o,consumerType:"apartment",orderId:(ie=(ce=l.data)==null?void 0:ce.data)==null?void 0:ie.order_id,payUpto:a.paidUpto}}}))}return}else{const l=await d({api:y.apartmentPayment,data:a.paymentMode==="Cash"?{apartmentId:o,paidAmount:(me=i.data)==null?void 0:me.data.totaldemand,paymentMode:a.paymentMode,paidUpto:a.paidUpto}:{apartmentId:o,paidAmount:(pe=i.data)==null?void 0:pe.data.totaldemand,paymentMode:a.paymentMode,paidUpto:a.paidUpto,bankName:a.bankName,branchName:a.branchName,chequeNo:a.chequeNo,chequeDate:a.chequeDate}});(xe=l==null?void 0:l.data)!=null&&xe.status?($e.success((he=l==null?void 0:l.data)==null?void 0:he.msg),t(`/deoghar-app/payment-receipt/${(ue=(fe=l==null?void 0:l.data)==null?void 0:fe.data)==null?void 0:ue.transactionNo}`,{replace:!0})):$e.error((be=l==null?void 0:l.data)==null?void 0:be.msg)}}catch{}})},_=(a,f)=>{const N=a==null?void 0:a.reduce((c,A)=>c+Number(A.total_tax),0);return e.jsx(Ua,{title:`${f}-(${N})`,buttonTitle:"View",children:e.jsx("div",{className:"h-96",children:e.jsxs(ye,{children:[e.jsx(Ae,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Demand from"}),e.jsx(x,{children:"Demand upto"}),e.jsx(x,{children:"Amount"}),e.jsx(x,{children:"Status"})]})}),e.jsx(we,{children:a==null?void 0:a.map((c,A)=>e.jsxs(q,{children:[e.jsx(h,{children:w(c.payment_from,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(h,{children:w(c.payment_to,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(h,{children:c.total_tax}),e.jsx(h,{children:c.paid_status=="0"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},A+1))})]})})})};return s!=null&&s.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(M,{children:e.jsxs(R,{children:[e.jsx(Y,{}),e.jsx(Y,{}),e.jsx(Y,{})]})})}):e.jsxs(na,{title:"Apartment Payment",children:[r&&e.jsx(pa,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(ma,{src:"/assets/image/apartment.png",alt:"Add Consumer",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:" font-semibold",children:"Apartment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solid waste management reminder list."})]})]}),e.jsx(C,{}),e.jsx(M,{children:e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment code:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(S=s==null?void 0:s.data)==null?void 0:S.data[0])==null?void 0:P.apartmentCode})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(U=(E=s==null?void 0:s.data)==null?void 0:E.data[0])==null?void 0:U.apartmentName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mobile no:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=(T=s==null?void 0:s.data)==null?void 0:T.data[0])==null?void 0:I.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(k=s==null?void 0:s.data)==null?void 0:k.totalAptMonthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(O=s==null?void 0:s.data)==null?void 0:O.totalAptDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Total flats:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:F.length})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(z=(B=s==null?void 0:s.data)==null?void 0:B.data[0])==null?void 0:z.address})})]})})}),e.jsx(C,{}),((H=s==null?void 0:s.data)==null?void 0:H.totalAptDemand)>0?e.jsxs(oa.Fragment,{children:[e.jsx(M,{children:e.jsx(R,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(C,{}),e.jsx("div",{children:e.jsxs(ye,{children:[e.jsx(Ae,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Consumer"}),e.jsx(x,{children:"Demand from"}),e.jsx(x,{children:"Demand upto"}),e.jsx(x,{children:"Amount"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Action"})]})}),e.jsx(we,{children:(Q=(W=(V=s==null?void 0:s.data)==null?void 0:V.data)==null?void 0:W.filter(a=>a.paidStatus!=="Paid"))==null?void 0:Q.map((a,f)=>e.jsxs(q,{children:[e.jsx(h,{children:a.consumerName}),e.jsx(h,{children:w(a.demandFrom,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(h,{children:w(a.demandUpto,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(h,{children:a.totaldemand}),e.jsx(h,{children:a.paidStatus=="Unpaid"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})}),e.jsx(h,{children:_(a==null?void 0:a.activeDemandDetails,a.consumerName)})]},f+1))})]})})]})})}),e.jsx(C,{}),e.jsx(M,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(R,{children:e.jsxs(ta,{methods:m,onSubmit:m.handleSubmit($),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(Ne,{isRequired:!0,name:"paidUpto",label:"Payment Amount",className:"w-full",data:((G=(K=(J=j==null?void 0:j.data)==null?void 0:J.data)==null?void 0:K.demand)==null?void 0:G.map(a=>({label:String(a.payment_to),value:String(a.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(Ne,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,type:"date",min:w().format("YYYY-MM-DD"),name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(g,{isRequired:!0,name:"chequeDate",min:w().format("YYYY-MM-DD"),type:"date",label:"DD Date",className:"w-full"})})]})}[m.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(qe,{type:"submit",className:"mx-auto",disabled:i.isLoading||j.isLoading,children:[e.jsx(la,{className:"mr-2 h-4 w-4"}),i!=null&&i.isLoading?"Calculating...":`Pay Now â‚¹ ${((X=i.data)==null?void 0:X.data.totaldemand)??0}`]})})]})})})]}):e.jsx(M,{children:e.jsx(R,{children:e.jsx("div",{className:"py-2 flex justify-center items-center mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{at as default};
