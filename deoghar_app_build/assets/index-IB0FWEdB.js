import{a as Ve,u as Je,h as Ke,g as De,e as m,j as e,I as ze,B as Ge,C as Xe,k as Oe,F as Le,_ as Ye}from"./index-DLJkMWUB.js";import{h as He}from"./moment-CbGOrKEH.js";import{u as Ze,F as ea,c as aa,a as i,o as sa}from"./switch-BXlVt4iJ.js";import{R as c}from"./RHFTextField-DfgCabiT.js";import{u as ta,i as da}from"./router-DWxcwEcu.js";import{R as Ee}from"./SelectField-CdkMqz-G.js";import{P as ra}from"./index-ChwPXrDZ.js";import{C as u,b as j}from"./card-DUlyuvVJ.js";import{T as la,a as na,b as $e,c as f,d as ia,e as y,H as ca}from"./table-WwAHV9Ik.js";import{S as b}from"./separator-DmTdbWr4.js";import{S as g}from"./SkeletonLoader-Cmr7szQM.js";import{O as oa}from"./OverLayLoader-D7AAhvmj.js";import"./headlessui-DlCzxctq.js";import"./axios-BrYcoDUu.js";import"./module-BOQ-SnDo.js";const ma=aa().shape({paymentMode:i().required("Payment mode is required"),paidUpto:i().required("Payment amount is required"),bankName:i().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>i().required("Bank name is required")}),branchName:i().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>i().required("Branch name is required")}),chequeDate:i().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>i().required("Cheque/DD date is required")}),chequeNo:i().when("paymentMode",{is:d=>d=="Cheque"||d=="Dd",then:()=>i().required("Cheque/DD number is required")})});function Ra(){var q,C,M,R,U,I,k,S,_,A,P,F,B,T,D,O,L,Y,H,E,$,W,Q,V,J,K,z,G,X,Z,ee,ae,se,te,de,re,le,ne,ie,ce,oe,me,xe,he,pe,ue,je;const d=ta(),{user:x}=Ve(),{mutateAsync:w,isLoading:We}=Je({}),{id:r}=da(),a=Ke({api:"".concat(m.getConsumerDetailsById,"/").concat(r),options:{enabled:!!r}}),h=Ze({resolver:sa(ma)}),N=De({api:m.getPaymentData,config:{consumerId:r},options:{enabled:!!r}}),l=De({api:m.getCalculatedAmount,config:{consumerId:r,payUpto:h.watch("paidUpto")},value:[h.watch("paidUpto")],options:{enabled:!!h.watch("paidUpto")&&!!r}}),v=async()=>{var s,o,p;try{const n=await w({api:m.generateOrder,data:{amount:(o=(s=l.data)==null?void 0:s.data)==null?void 0:o.totaldemand,consumerId:r,consumerType:"consumer"}});return(p=n==null?void 0:n.data)!=null&&p.status,n}catch(n){return n}},Qe=async s=>{Xe("Are you sure to pay?","Please confirm",async()=>{var o,p,n,Ne,fe,ye,be,ge,we,ve,qe,Ce,Me,Re,Ue,Ie,ke,Se,_e,Ae,Pe,Fe,Be,Te;try{if((s==null?void 0:s.paymentMode)=="Card"){if(window.ReactNativeWebView){const t=await v();(o=t==null?void 0:t.data)!=null&&o.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(n=(p=l.data)==null?void 0:p.data)==null?void 0:n.totaldemand,consumerId:r,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:Oe+m.addOrder,token:localStorage.getItem("token"),tranId:(fe=(Ne=t.data)==null?void 0:Ne.data)==null?void 0:fe.order_id,redirectUrl:Le+"/deoghar-app/payment-receipt",payload:{amount:(be=(ye=l.data)==null?void 0:ye.data)==null?void 0:be.totaldemand,consumerId:r,consumerType:"consumer",orderId:(we=(ge=t.data)==null?void 0:ge.data)==null?void 0:we.order_id,payUpto:s.paidUpto,userId:x==null?void 0:x.id}}}))}return}if((s==null?void 0:s.paymentMode)=="QR"){if(window!=null&&window.ReactNativeWebView){const t=await v();(ve=t==null?void 0:t.data)!=null&&ve.status&&((_e=window==null?void 0:window.ReactNativeWebView)==null||_e.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(Ce=(qe=l.data)==null?void 0:qe.data)==null?void 0:Ce.totaldemand,consumerId:r,paidUpto:s.paidUpto,paymentMode:s.paymentMode,api:Oe+m.addOrder,tranId:(Re=(Me=t.data)==null?void 0:Me.data)==null?void 0:Re.order_id,token:localStorage.getItem("token"),redirectUrl:Le+"/deoghar-app/payment-receipt",payload:{amount:(Ie=(Ue=l.data)==null?void 0:Ue.data)==null?void 0:Ie.totaldemand,consumerId:r,consumerType:"consumer",orderId:(Se=(ke=t.data)==null?void 0:ke.data)==null?void 0:Se.order_id,payUpto:s.paidUpto,userId:x==null?void 0:x.id}}})))}return}else{const t=await w({api:m.postPayment,data:s.paymentMode==="Cash"?{consumerId:r,paidAmount:(Ae=l.data)==null?void 0:Ae.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto}:{consumerId:r,paidAmount:(Pe=l.data)==null?void 0:Pe.data.totaldemand,paymentMode:s.paymentMode,paidUpto:s.paidUpto,bankName:s.bankName,branchName:s.branchName,chequeNo:s.chequeNo,chequeDate:s.chequeDate}});(Fe=t==null?void 0:t.data)!=null&&Fe.status?(Ye.success(t==null?void 0:t.data.msg),d("/deoghar-app/payment-receipt/".concat((Te=(Be=t==null?void 0:t.data)==null?void 0:Be.data)==null?void 0:Te.transactionNo),{replace:!0})):Ye.error(t==null?void 0:t.data.msg)}}catch(t){}})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(u,{children:e.jsxs(j,{children:[e.jsx(g,{}),e.jsx(g,{}),e.jsx(g,{})]})})}):e.jsxs(ra,{title:"Consumer Payment",children:[We&&e.jsx(oa,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(ze,{src:"/assets/image/category.png",alt:"Consumer Payment",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Consumer Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Consumer payment details here."})]})]}),e.jsx(b,{}),e.jsx(u,{children:e.jsx(j,{children:e.jsxs("div",{className:"flex flex-wrap",children:[e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(C=(q=a==null?void 0:a.data)==null?void 0:q.data[0])==null?void 0:C.consumerNo})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(R=(M=a==null?void 0:a.data)==null?void 0:M.data[0])==null?void 0:R.consumerName})}),((I=(U=a==null?void 0:a.data)==null?void 0:U.data[0])==null?void 0:I.holdingNo)!=""&&((S=(k=a==null?void 0:a.data)==null?void 0:k.data[0])==null?void 0:S.holdingNo)!=null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding No:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(P=(A=(_=a==null?void 0:a.data)==null?void 0:_.data[0])==null?void 0:A.holdingNo)!=null?P:"--"})})]}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Mobile:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(B=(F=a==null?void 0:a.data)==null?void 0:F.data[0])==null?void 0:B.mobileNo})}),((D=(T=a==null?void 0:a.data)==null?void 0:T.data[0])==null?void 0:D.monthlyDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(L=(O=a==null?void 0:a.data)==null?void 0:O.data[0])==null?void 0:L.monthlyDemand})})]}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(H=(Y=a==null?void 0:a.data)==null?void 0:Y.data[0])==null?void 0:H.totalDemand})}),(($=(E=a==null?void 0:a.data)==null?void 0:E.data[0])==null?void 0:$.totalDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(Q=(W=a==null?void 0:a.data)==null?void 0:W.data[0])==null?void 0:Q.demandFrom})})]}),((J=(V=a==null?void 0:a.data)==null?void 0:V.data[0])==null?void 0:J.totalDemand)>"0"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(z=(K=a==null?void 0:a.data)==null?void 0:K.data[0])==null?void 0:z.demandUpto})})]}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer type:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(X=(G=a==null?void 0:a.data)==null?void 0:G.data[0])==null?void 0:X.cansumerType})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(ee=(Z=a==null?void 0:a.data)==null?void 0:Z.data[0])==null?void 0:ee.Address})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply Date:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(se=(ae=a==null?void 0:a.data)==null?void 0:ae.data[0])==null?void 0:se.applyDate})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply By:"})}),e.jsx("div",{className:"flex flex-col cursor-pointer mt-3 w-1/2",children:e.jsx("h1",{className:"text-xs",children:(de=(te=a==null?void 0:a.data)==null?void 0:te.data[0])==null?void 0:de.applyBy})})]})})}),e.jsx(b,{className:"mt-2 mb-2"}),((ne=(le=(re=a==null?void 0:a.data)==null?void 0:re.data[0])==null?void 0:le.activeDemandDetails)==null?void 0:ne.length)>0?e.jsxs(e.Fragment,{children:[" ",e.jsx(u,{children:e.jsx(j,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(b,{}),e.jsx("div",{children:e.jsxs(la,{children:[e.jsx(na,{children:e.jsxs($e,{children:[e.jsx(f,{children:"Demand from"}),e.jsx(f,{children:"Demand upto"}),e.jsx(f,{children:"Amount"}),e.jsx(f,{children:"Status"})]})}),e.jsx(ia,{children:(oe=(ce=(ie=a==null?void 0:a.data)==null?void 0:ie.data[0])==null?void 0:ce.activeDemandDetails)==null?void 0:oe.map((s,o)=>e.jsxs($e,{children:[e.jsx(y,{children:He(s.payment_from).format("DD-MMM-YYYY")}),e.jsx(y,{children:He(s.payment_to).format("DD-MMM-YYYY")}),e.jsx(y,{children:s.total_tax}),e.jsx(y,{children:s.paid_status==0?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},o+1))})]})})]})})}),e.jsx(b,{}),e.jsx(u,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(j,{children:e.jsxs(ea,{methods:h,onSubmit:h.handleSubmit(Qe),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{className:"mt-3",children:e.jsx(Ee,{isRequired:!0,name:"paidUpto",label:"Payment upto month",className:"w-full",data:(pe=(he=(xe=(me=N==null?void 0:N.data)==null?void 0:me.data)==null?void 0:xe.demand)==null?void 0:he.map(s=>({label:String(s.payment_to),value:String(s.payment_to)})))!=null?pe:[]})}),e.jsx("div",{className:"mt-3",children:e.jsx(Ee,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,type:"date",name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{className:"mt-3",children:e.jsx(c,{isRequired:!0,name:"chequeDate",type:"date",label:"DD Date",className:"w-full"})})]})}[h.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(Ge,{type:"submit",className:"mx-auto bg-green-500 hover:bg-green-600 text-white",disabled:l.isLoading||N.isLoading,children:[e.jsx(ca,{className:"mr-2 h-4 w-4"}),l!=null&&l.isLoading?"Calculating...":"Pay Now â‚¹ ".concat((je=(ue=l.data)==null?void 0:ue.data.totaldemand)!=null?je:0)]})})]})})})]}):e.jsx(u,{children:e.jsx(j,{children:e.jsx("div",{className:"py-2 flex justify-center items-center",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{Ra as default};
