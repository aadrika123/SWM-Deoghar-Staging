import{h as Re,i as xe,k as Ye,l as h,m as fe,n as Ce,o as Pe,p as Se,q as Ue,r as Ee,s as ke,t as he,v as qe,w as Te,x as Ie,j as e,y as w,g as v,B as Oe,_ as re}from"./index-la4gHuXa.js";import{h as A}from"./moment-BjLXg0w5.js";import{a as Le,o as Fe,F as Be,S as le,c as ze,b as m}from"./SelectField-C4pz_3Bi.js";import{R as j}from"./RHFTextField-2qswbLJb.js";import{b as ue,B as be}from"./button--ybDpWiN.js";import{r,b as He,f as Ve,R as We}from"./router-DQohkvhc.js";import{P as Qe}from"./index-CsGSmyQk.js";import{C as D,b as M}from"./card-B5LHCMVv.js";import{T as ce,a as ie,b as Y,c as p,d as me,e as x,H as Je}from"./table-BGXo66yB.js";import{u as Ke,b as Ge,a as pe}from"./useCustomQuery-DHvLYzCe.js";import{S as C}from"./separator-BfS78ucS.js";import{S as P}from"./SkeletonLoader-DvL1gx1u.js";import{I as Xe}from"./Image-CQpUgjc7.js";import{O as Ze}from"./OverLayLoader-9_qGUxFB.js";import{C as ea}from"./index-BThOhgyN.js";import"./headlessui-qWRqSxHB.js";import"./axios-DmypytPv.js";import"./module-meE13Ke_.js";const aa="AlertDialog",[ta,za]=Re(aa,[xe]),u=xe(),sa=o=>{const{__scopeAlertDialog:d,...s}=o,n=u(d);return r.createElement(Te,h({},n,s,{modal:!0}))},oa=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,a=u(s);return r.createElement(Ie,h({},a,n,{ref:d}))}),da=o=>{const{__scopeAlertDialog:d,...s}=o,n=u(d);return r.createElement(qe,h({},n,s))},na=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,a=u(s);return r.createElement(Ye,h({},a,n,{ref:d}))}),je="AlertDialogContent",[ra,la]=ta(je),ca=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,children:n,...a}=o,i=u(s),b=r.useRef(null),l=fe(d,b),_=r.useRef(null);return r.createElement(Ce,{contentName:je,titleName:ia,docsSlug:"alert-dialog"},r.createElement(ra,{scope:s,cancelRef:_},r.createElement(Pe,h({role:"alertdialog"},i,a,{ref:l,onOpenAutoFocus:Se(a.onOpenAutoFocus,g=>{var $;g.preventDefault(),($=_.current)===null||$===void 0||$.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault()}),r.createElement(Ue,null,n),!1)))}),ia="AlertDialogTitle",ma=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,a=u(s);return r.createElement(Ee,h({},a,n,{ref:d}))}),pa=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,a=u(s);return r.createElement(ke,h({},a,n,{ref:d}))}),xa=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,a=u(s);return r.createElement(he,h({},a,n,{ref:d}))}),fa="AlertDialogCancel",ha=r.forwardRef((o,d)=>{const{__scopeAlertDialog:s,...n}=o,{cancelRef:a}=la(fa,s),i=u(s),b=fe(d,a);return r.createElement(he,h({},i,n,{ref:b}))}),ua=sa,ba=oa,ja=da,ge=na,$e=ca,Ne=xa,ye=ha,ve=ma,Ae=pa,ga=ua,$a=ba,Na=ja,we=r.forwardRef(({className:o,...d},s)=>e.jsx(ge,{className:w("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...d,ref:s}));we.displayName=ge.displayName;const De=r.forwardRef(({className:o,...d},s)=>e.jsxs(Na,{children:[e.jsx(we,{}),e.jsx($e,{ref:s,className:w("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...d})]}));De.displayName=$e.displayName;const Me=r.forwardRef(({className:o,...d},s)=>e.jsx(ve,{ref:s,className:w("text-lg font-semibold",o),...d}));Me.displayName=ve.displayName;const ya=r.forwardRef(({className:o,...d},s)=>e.jsx(Ae,{ref:s,className:w("text-sm text-muted-foreground",o),...d}));ya.displayName=Ae.displayName;const va=r.forwardRef(({className:o,...d},s)=>e.jsx(Ne,{ref:s,className:w(ue(),o),...d}));va.displayName=Ne.displayName;const _e=r.forwardRef(({className:o,...d},s)=>e.jsx(ye,{ref:s,className:w(ue({variant:"outline"}),"mt-2 sm:mt-0",o),...d}));_e.displayName=ye.displayName;function Aa({children:o,buttonTitle:d,title:s}){return e.jsxs(ga,{children:[e.jsx($a,{asChild:!0,children:e.jsx(be,{variant:"outline",size:"sm",children:d??"Open"})}),e.jsxs(De,{className:"rounded-lg w-[95%] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{children:s??"Alert Dialog Title"}),e.jsx(_e,{className:"w-8 h-8 px-2 rounded-lg hover:bg-gray-200",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 8.586l3.293-3.293 1.414 1.414L11.414 10l3.293 3.293-1.414 1.414L10 11.414l-3.293 3.293-1.414-1.414L8.586 10 5.293 6.707l1.414-1.414L10 8.586z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"py-2 overflow-scroll",children:o})]})]})}const wa=ze().shape({paymentMode:m().required("Payment mode is required"),paidUpto:m().required("Payment amount is required"),bankName:m().when("paymentMode",{is:"Dd",then:()=>m()}),branchName:m().when("paymentMode",{is:"Dd",then:()=>m()}),chequeDate:m().when("paymentMode",{is:"Dd",then:()=>m()}),chequeNo:m().when("paymentMode",{is:"Dd",then:()=>m()})});function Ha(){var $,S,U,E,k,q,T,I,O,L,F,B,z,H,V,W,Q,J,K,G;const o=He(),{mutateAsync:d,isPending:s}=Ke({}),{id:n}=Ve(),a=Ge({api:`${v.getApartmentDetailsById}/${n}`,options:{enabled:!!n}}),i=Le({resolver:Fe(wa)}),b=pe({api:v.getPaymentData,config:{apartmentId:n},options:{enabled:!!n}}),l=pe({api:v.getCalculatedAmount,config:{apartmentId:n,payUpto:i.watch("paidUpto")},value:[i.watch("paidUpto")],options:{enabled:!!i.watch("paidUpto")&&!!n}}),_=async t=>{ea("Are you sure to pay?","Please confirm",async()=>{var N,R,f,y,X,Z,ee,ae,te,se,oe,de,ne;try{if((t==null?void 0:t.paymentMode)=="Card"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(R=(N=l.data)==null?void 0:N.data)==null?void 0:R.totaldemand,apartmentId:n,paidUpto:t.paidUpto,paymentMode:t.paymentMode,api:v.apartmentPayment,token:localStorage.getItem("token"),redirectUrl:window.location.origin+"/deoghar-app/payment-receipt",payload:{apartmentId:n,paidAmount:(f=l.data)==null?void 0:f.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto}}}));return}if((t==null?void 0:t.paymentMode)=="QR"){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(X=(y=l.data)==null?void 0:y.data)==null?void 0:X.totaldemand,apartmentId:n,paidUpto:t.paidUpto,paymentMode:t.paymentMode,api:Oe+v.apartmentPayment,token:localStorage.getItem("token"),redirectUrl:window.location.origin+"/deoghar-app/payment-receipt",payload:{apartmentId:n,paidAmount:(Z=l.data)==null?void 0:Z.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto}}}));return}else{const c=await d({api:v.apartmentPayment,data:t.paymentMode==="Cash"?{apartmentId:n,paidAmount:(ee=l.data)==null?void 0:ee.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto}:{apartmentId:n,paidAmount:(ae=l.data)==null?void 0:ae.data.totaldemand,paymentMode:t.paymentMode,paidUpto:t.paidUpto,bankName:t.bankName,branchName:t.branchName,chequeNo:t.chequeNo,chequeDate:t.chequeDate}});(te=c==null?void 0:c.data)!=null&&te.status?(re.success((se=c==null?void 0:c.data)==null?void 0:se.msg),o(`/deoghar-app/payment-receipt/${(de=(oe=c==null?void 0:c.data)==null?void 0:oe.data)==null?void 0:de.transactionNo}`,{replace:!0})):re.error((ne=c==null?void 0:c.data)==null?void 0:ne.msg)}}catch{}})},g=(t,N)=>{const R=t==null?void 0:t.reduce((f,y)=>f+Number(y.total_tax),0);return e.jsx(Aa,{title:`${N}-(${R})`,buttonTitle:"View",children:e.jsx("div",{className:"h-96",children:e.jsxs(ce,{children:[e.jsx(ie,{children:e.jsxs(Y,{children:[e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"})]})}),e.jsx(me,{children:t==null?void 0:t.map((f,y)=>e.jsxs(Y,{children:[e.jsx(x,{children:A(f.payment_from,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:A(f.payment_to,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:f.total_tax}),e.jsx(x,{children:f.paid_status=="0"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},y+1))})]})})})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(D,{children:e.jsxs(M,{children:[e.jsx(P,{}),e.jsx(P,{}),e.jsx(P,{})]})})}):e.jsxs(Qe,{title:"Apartment Payment",children:[s&&e.jsx(Ze,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(Xe,{src:"/assets/image/apartment.png",alt:"Add Consumer",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:" font-semibold",children:"Apartment Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Solid waste management reminder list."})]})]}),e.jsx(C,{}),e.jsx(D,{children:e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment code:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(S=($=a==null?void 0:a.data)==null?void 0:$.data[0])==null?void 0:S.apartmentCode})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apartment Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(E=(U=a==null?void 0:a.data)==null?void 0:U.data[0])==null?void 0:E.apartmentName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mobile no:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(q=(k=a==null?void 0:a.data)==null?void 0:k.data[0])==null?void 0:q.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(T=a==null?void 0:a.data)==null?void 0:T.totalAptMonthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=a==null?void 0:a.data)==null?void 0:I.totalAptDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Total flats:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:L.length})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=(F=a==null?void 0:a.data)==null?void 0:F.data[0])==null?void 0:B.address})})]})})}),e.jsx(C,{}),((z=a==null?void 0:a.data)==null?void 0:z.totalAptDemand)>0?e.jsxs(We.Fragment,{children:[e.jsx(D,{children:e.jsx(M,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(C,{}),e.jsx("div",{children:e.jsxs(ce,{children:[e.jsx(ie,{children:e.jsxs(Y,{children:[e.jsx(p,{children:"Consumer"}),e.jsx(p,{children:"Demand from"}),e.jsx(p,{children:"Demand upto"}),e.jsx(p,{children:"Amount"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(me,{children:(W=(V=(H=a==null?void 0:a.data)==null?void 0:H.data)==null?void 0:V.filter(t=>t.paidStatus!=="Paid"))==null?void 0:W.map((t,N)=>e.jsxs(Y,{children:[e.jsx(x,{children:t.consumerName}),e.jsx(x,{children:A(t.demandFrom,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:A(t.demandUpto,"DD-MM-YYYY").format("DD-MMM-YYYY")}),e.jsx(x,{children:t.totaldemand}),e.jsx(x,{children:t.paidStatus=="Unpaid"?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})}),e.jsx(x,{children:g(t==null?void 0:t.activeDemandDetails,t.consumerName)})]},N+1))})]})})]})})}),e.jsx(C,{}),e.jsx(D,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(M,{children:e.jsxs(Be,{methods:i,onSubmit:i.handleSubmit(_),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(le,{name:"paidUpto",label:"Payment Amount",className:"w-full",data:((K=(J=(Q=b==null?void 0:b.data)==null?void 0:Q.data)==null?void 0:J.demand)==null?void 0:K.map(t=>({label:String(t.payment_to),value:String(t.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(le,{name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(j,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{type:"date",min:A().format("YYYY-MM-DD"),name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(j,{name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(j,{name:"chequeDate",min:A().format("YYYY-MM-DD"),type:"date",label:"DD Date",className:"w-full"})})]})}[i.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(be,{type:"submit",className:"mx-auto",disabled:l.isLoading||b.isLoading,children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),l!=null&&l.isLoading?"Calculating...":`Pay Now â‚¹ ${((G=l.data)==null?void 0:G.data.totaldemand)??0}`]})})]})})})]}):e.jsx(D,{children:e.jsx(M,{children:e.jsx("div",{className:"py-2 flex justify-center items-center mt-4",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{Ha as default};
