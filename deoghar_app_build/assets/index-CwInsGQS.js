import{d as c,j as e,B as Ie,C as Se,g as ge,F as ve,_ as qe}from"./index-CXWgykNr.js";import{h as we}from"./moment-BjLXg0w5.js";import{u as Pe,o as _e,F as ke,S as Ce,c as Ae,a as l}from"./SelectField-DPbQT4k9.js";import{R as o}from"./RHFTextField-0TCqLuwJ.js";import{d as Be,h as Te}from"./router-CTqkcgir.js";import{P as Fe}from"./index-DzBGrloV.js";import{C as p,b as u}from"./card-44yBSR91.js";import{T as Oe,a as Le,b as Me,c as N,d as Ye,e as y,H as Ee}from"./table-CiBRiZVo.js";import{u as He,b as $e,a as Re}from"./useCustomQuery-C28Jnslk.js";import{S as b}from"./separator-D0SQ8XCb.js";import{S as f}from"./SkeletonLoader-D0E9Ju14.js";import{I as We}from"./Image-CpCNUEr-.js";import{O as Qe}from"./OverLayLoader-CZvTUKpQ.js";import"./headlessui-BV7w-sRG.js";import"./axios-DmypytPv.js";import"./module-CgyVyzRT.js";const Ve=Ae().shape({paymentMode:l().required("Payment mode is required"),paidUpto:l().required("Payment amount is required"),bankName:l().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>l().required("Bank name is required")}),branchName:l().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>l().required("Branch name is required")}),chequeDate:l().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>l().required("Cheque/DD date is required")}),chequeNo:l().when("paymentMode",{is:t=>t=="Cheque"||t=="Dd",then:()=>l().required("Cheque/DD number is required")})});function ma(){var q,w,C,M,R,U,D,I,S,P,_,k,A,B,T,F,O,L,Y,E,H,$,W,Q,V,J,K,z,G,X,Z,ee;const t=Be(),{mutateAsync:g,isPending:Ue}=He({}),{id:i}=Te(),a=$e({api:`${c.getConsumerDetailsById}/${i}`,options:{enabled:!!i}}),h=Pe({resolver:_e(Ve)}),j=Re({api:c.getPaymentData,config:{consumerId:i},options:{enabled:!!i}}),n=Re({api:c.getCalculatedAmount,config:{consumerId:i,payUpto:h.watch("paidUpto")},value:[h.watch("paidUpto")],options:{enabled:!!h.watch("paidUpto")&&!!i}}),v=async()=>{var d,m,x;try{const r=await g({api:c.generateOrder,data:{amount:(m=(d=n.data)==null?void 0:d.data)==null?void 0:m.totaldemand,consumerId:i,consumerType:"consumer"}});return(x=r==null?void 0:r.data)!=null&&x.status,r}catch(r){return r}},De=async d=>{Se("Are you sure to pay?","Please confirm",async()=>{var m,x,r,ae,de,se,te,ie,ne,re,le,oe,me,ce,he,xe,pe,ue,je,Ne,ye,be,fe;try{if((d==null?void 0:d.paymentMode)=="Card"){if(window.ReactNativeWebView){const s=await v();(m=s==null?void 0:s.data)!=null&&m.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE",keyData:{amount:(r=(x=n.data)==null?void 0:x.data)==null?void 0:r.totaldemand,consumerId:i,paidUpto:d.paidUpto,paymentMode:d.paymentMode,api:ge+c.addOrder,token:localStorage.getItem("token"),tranId:(de=(ae=s.data)==null?void 0:ae.data)==null?void 0:de.order_id,redirectUrl:ve+"/deoghar-app/payment-receipt",payload:{amount:(te=(se=n.data)==null?void 0:se.data)==null?void 0:te.totaldemand,consumerId:i,consumerType:"consumer",orderId:(ne=(ie=s.data)==null?void 0:ie.data)==null?void 0:ne.order_id,payUpto:d.paidUpto}}}))}return}if((d==null?void 0:d.paymentMode)=="QR"){if(window.ReactNativeWebView){const s=await v();(re=s==null?void 0:s.data)!=null&&re.status&&window.ReactNativeWebView.postMessage(JSON.stringify({Key:"DO_SALE_WITH_QR",keyData:{amount:(oe=(le=n.data)==null?void 0:le.data)==null?void 0:oe.totaldemand,consumerId:i,paidUpto:d.paidUpto,paymentMode:d.paymentMode,api:ge+c.addOrder,tranId:(ce=(me=s.data)==null?void 0:me.data)==null?void 0:ce.order_id,token:localStorage.getItem("token"),redirectUrl:ve+"/deoghar-app/payment-receipt",payload:{amount:(xe=(he=n.data)==null?void 0:he.data)==null?void 0:xe.totaldemand,consumerId:i,consumerType:"consumer",orderId:(ue=(pe=s.data)==null?void 0:pe.data)==null?void 0:ue.order_id,payUpto:d.paidUpto}}}))}return}else{const s=await g({api:c.postPayment,data:d.paymentMode==="Cash"?{consumerId:i,paidAmount:(je=n.data)==null?void 0:je.data.totaldemand,paymentMode:d.paymentMode,paidUpto:d.paidUpto}:{consumerId:i,paidAmount:(Ne=n.data)==null?void 0:Ne.data.totaldemand,paymentMode:d.paymentMode,paidUpto:d.paidUpto,bankName:d.bankName,branchName:d.branchName,chequeNo:d.chequeNo,chequeDate:d.chequeDate}});(ye=s==null?void 0:s.data)!=null&&ye.status?(qe.success(s==null?void 0:s.data.msg),t(`/deoghar-app/payment-receipt/${(fe=(be=s==null?void 0:s.data)==null?void 0:be.data)==null?void 0:fe.transactionNo}`,{replace:!0})):qe.error(s==null?void 0:s.data.msg)}}catch{}})};return a!=null&&a.isLoading?e.jsx("div",{className:"p-6 bg-white border border-gray-200 rounded-lg shadow-sm",children:e.jsx(p,{children:e.jsxs(u,{children:[e.jsx(f,{}),e.jsx(f,{}),e.jsx(f,{})]})})}):e.jsxs(Fe,{title:"Consumer Payment",children:[Ue&&e.jsx(Qe,{}),e.jsxs("main",{className:"py-6 grid grid-cols-1 gap-4 px-4",children:[e.jsxs("div",{className:"flex space-x-3 items-center justify-start",children:[e.jsx(We,{src:"/assets/image/category.png",alt:"Consumer Payment",className:"w-11 h-11 rounded-lg bg-gray-200 p-2"}),e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-semibold",children:"Consumer Payment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Consumer payment details here."})]})]}),e.jsx(b,{}),e.jsx(p,{children:e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 py-6",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(w=(q=a==null?void 0:a.data)==null?void 0:q.data[0])==null?void 0:w.consumerNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(M=(C=a==null?void 0:a.data)==null?void 0:C.data[0])==null?void 0:M.consumerName})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Mobile:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(U=(R=a==null?void 0:a.data)==null?void 0:R.data[0])==null?void 0:U.mobileNo})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Monthly Demand/Rate:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=(D=a==null?void 0:a.data)==null?void 0:D.data[0])==null?void 0:I.monthlyDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Outstanding Demand:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=(S=a==null?void 0:a.data)==null?void 0:S.data[0])==null?void 0:P.totalDemand})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand upto:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(k=(_=a==null?void 0:a.data)==null?void 0:_.data[0])==null?void 0:k.demandUpto})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand from:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=(A=a==null?void 0:a.data)==null?void 0:A.data[0])==null?void 0:B.demandFrom})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer type:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(F=(T=a==null?void 0:a.data)==null?void 0:T.data[0])==null?void 0:F.cansumerType})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=(O=a==null?void 0:a.data)==null?void 0:O.data[0])==null?void 0:L.Address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply Date:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(E=(Y=a==null?void 0:a.data)==null?void 0:Y.data[0])==null?void 0:E.applyDate})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Apply By:"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:($=(H=a==null?void 0:a.data)==null?void 0:H.data[0])==null?void 0:$.applyBy})})]})})}),e.jsx(b,{}),((V=(Q=(W=a==null?void 0:a.data)==null?void 0:W.data[0])==null?void 0:Q.activeDemandDetails)==null?void 0:V.length)>0?e.jsxs(e.Fragment,{children:[" ",e.jsx(p,{children:e.jsx(u,{children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"px-4 mb-2",children:e.jsx("h1",{className:"text-xs font-semibold",children:"Demand Detail"})}),e.jsx(b,{}),e.jsx("div",{children:e.jsxs(Oe,{children:[e.jsx(Le,{children:e.jsxs(Me,{children:[e.jsx(N,{children:"Demand from"}),e.jsx(N,{children:"Demand upto"}),e.jsx(N,{children:"Amount"}),e.jsx(N,{children:"Status"})]})}),e.jsx(Ye,{children:(z=(K=(J=a==null?void 0:a.data)==null?void 0:J.data[0])==null?void 0:K.activeDemandDetails)==null?void 0:z.map((d,m)=>e.jsxs(Me,{children:[e.jsx(y,{children:we(d.payment_from).format("DD-MMM-YYYY")}),e.jsx(y,{children:we(d.payment_to).format("DD-MMM-YYYY")}),e.jsx(y,{children:d.total_tax}),e.jsx(y,{children:d.paid_status==0?e.jsx("span",{className:"text-red-500",children:"Unpaid"}):e.jsx("span",{className:"text-green-500",children:"Paid"})})]},m+1))})]})})]})})}),e.jsx(b,{}),e.jsx(p,{"x-chunk":"dashboard-05-chunk-4",children:e.jsx(u,{children:e.jsxs(ke,{methods:h,onSubmit:h.handleSubmit(De),children:[e.jsxs("div",{className:"grid gap-6",children:[e.jsx("div",{children:e.jsx(Ce,{isRequired:!0,name:"paidUpto",label:"Payment Amount",className:"w-full",data:((Z=(X=(G=j==null?void 0:j.data)==null?void 0:G.data)==null?void 0:X.demand)==null?void 0:Z.map(d=>({label:String(d.payment_to),value:String(d.payment_to)})))??[]})}),e.jsx("div",{children:e.jsx(Ce,{isRequired:!0,name:"paymentMode",label:"Payment Mode",className:"w-full",data:[{label:"Cash",value:"Cash"},{label:"Cheque",value:"Cheque"},{label:"DD",value:"Dd"},{label:"Card",value:"Card"},{label:"QR",value:"QR"}]})}),{Cheque:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeNo",label:"Cheque Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,type:"date",name:"chequeDate",label:"Cheque Date",className:"w-full"})})]}),Dd:e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"bankName",label:"Bank Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"branchName",label:"Branch Name",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeNo",label:"DD Number",className:"w-full"})}),e.jsx("div",{children:e.jsx(o,{isRequired:!0,name:"chequeDate",type:"date",label:"DD Date",className:"w-full"})})]})}[h.watch("paymentMode")]]}),e.jsx("div",{className:"grid grid-cols-1 gap-6 mt-4",children:e.jsxs(Ie,{type:"submit",className:"mx-auto",disabled:n.isLoading||j.isLoading,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),n!=null&&n.isLoading?"Calculating...":`Pay Now â‚¹ ${((ee=n.data)==null?void 0:ee.data.totaldemand)??0}`]})})]})})})]}):e.jsx(p,{children:e.jsx(u,{children:e.jsx("div",{className:"py-2 flex justify-center items-center",children:e.jsx("h1",{className:"text-base font-semibold text-center text-green-600",children:"You have no outstanding demand"})})})})]})]})}export{ma as default};
